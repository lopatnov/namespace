{"version":3,"file":"namespace.es.js","sources":["../src/namespace.ts"],"sourcesContent":["type NamespacePath = string | Array<string>;\n\n/** Namespace class */\nexport default class Namespace {\n  public static attach<T>(to: T): T & Namespace {\n    let names = Object.keys(Namespace.prototype);\n    for (let name of names) {\n      (to as any)[name] = (Namespace.prototype as any)[name];\n    }\n    return to as T & Namespace;\n  }\n\n  constructor(path?: NamespacePath) {\n    if (!(this instanceof Namespace))\n      return new Namespace(path);\n    this.init(path);\n  }\n\n  protected init(path: NamespacePath | undefined) {\n    if (this.isValidPath(path)) {\n      const pathArr = this.parsePath(path as string | Array<string>);\n      const childName = pathArr.shift();\n      if (this.isValidKey(childName)) {\n        this.appendChildren(pathArr, childName as string);\n      }\n    }\n  }\n\n  private isValidPath(path: NamespacePath | undefined) {\n    return typeof path === 'string' || (Array.isArray(path) && path.length > 0);\n  }\n\n  private parsePath(path: NamespacePath): string[] {\n    return Array.isArray(path) ? path : path.split(this.getSplitter()).filter(x => this.filterName(x))\n  }\n\n  protected getSplitter() {\n    return /[\\[\\].\"']/gi;\n  }\n\n  protected filterName(name: string) {\n    return !!name && !!name.trim();\n  }\n\n  protected isValidKey(name: string | undefined): boolean {\n    return typeof name === 'string';\n  }\n\n  protected getNamespaceClass() {\n    return this instanceof Namespace ? this.constructor as typeof Namespace : Namespace;\n  }\n\n  protected take(path: NamespacePath) {\n    const isValidPath = this.isValidPath(path);\n    let context: any = this;\n    let errContext: any = undefined;\n    let exists = true;\n    let parts: string[] = [];\n    let part: string | undefined;\n\n    if (isValidPath) {\n      parts = this.parsePath(path);\n      while (parts.length > 0) {\n        part = parts.shift();\n        if (part && context[part]) {\n          context = context[part];\n        } else {\n          exists = false;\n          errContext = part ? context[part] : undefined;\n          break;\n        }\n      }\n    }\n\n    return {\n      last: context,\n      lastName: part,\n      errLast: errContext,\n      left: parts,\n      exists,\n      isValidPath\n    }\n  }\n\n  protected appendChildren(path: NamespacePath | undefined, propName: string) {\n    const nsc = this.getNamespaceClass();\n    const ns = new nsc(path);\n    ns.applyTo(this, propName as string);\n    return ns;\n  }\n\n  public applyTo(context: any, name: string): void {\n    if (!this.isValidKey(name))\n      throw new Error(`name of context is ${'' + name}`);\n    context[name] = this;\n  }\n\n  public exists(path: NamespacePath): boolean {\n    const res = this.take(path);\n    return res.exists;\n  }\n\n  public goto(path: NamespacePath): any {\n    const res = this.take(path);\n    if (res.exists) {\n      return res.last;\n    }\n    return res.errLast;\n  }\n\n  public namespace(path: NamespacePath): Namespace {\n    const res = this.take(path);\n    if (!res.exists) {\n      const last = this.appendChildren.call(res.last, res.left.slice(), res.lastName as string);\n      return last.goto(res.left) as Namespace;\n    }\n    return res.last;\n  }\n}"],"names":[],"mappings":"AAEA;;IAUE,mBAAY,IAAoB;QAC9B,IAAI,EAAE,IAAI,YAAY,SAAS,CAAC;YAC9B,OAAO,IAAI,SAAS,CAAC,IAAI,CAAC,CAAC;QAC7B,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;KACjB;IAZa,gBAAM,GAApB,UAAwB,EAAK;QAC3B,IAAI,KAAK,GAAG,MAAM,CAAC,IAAI,CAAC,SAAS,CAAC,SAAS,CAAC,CAAC;QAC7C,KAAiB,UAAK,EAAL,eAAK,EAAL,mBAAK,EAAL,IAAK,EAAE;YAAnB,IAAI,MAAI,cAAA;YACV,EAAU,CAAC,MAAI,CAAC,GAAI,SAAS,CAAC,SAAiB,CAAC,MAAI,CAAC,CAAC;SACxD;QACD,OAAO,EAAmB,CAAC;KAC5B;IAQS,wBAAI,GAAd,UAAe,IAA+B;QAC5C,IAAI,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,EAAE;YAC1B,IAAM,OAAO,GAAG,IAAI,CAAC,SAAS,CAAC,IAA8B,CAAC,CAAC;YAC/D,IAAM,SAAS,GAAG,OAAO,CAAC,KAAK,EAAE,CAAC;YAClC,IAAI,IAAI,CAAC,UAAU,CAAC,SAAS,CAAC,EAAE;gBAC9B,IAAI,CAAC,cAAc,CAAC,OAAO,EAAE,SAAmB,CAAC,CAAC;aACnD;SACF;KACF;IAEO,+BAAW,GAAnB,UAAoB,IAA+B;QACjD,OAAO,OAAO,IAAI,KAAK,QAAQ,KAAK,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,IAAI,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;KAC7E;IAEO,6BAAS,GAAjB,UAAkB,IAAmB;QAArC,iBAEC;QADC,OAAO,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC,GAAG,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,WAAW,EAAE,CAAC,CAAC,MAAM,CAAC,UAAA,CAAC,IAAI,OAAA,KAAI,CAAC,UAAU,CAAC,CAAC,CAAC,GAAA,CAAC,CAAA;KACnG;IAES,+BAAW,GAArB;QACE,OAAO,aAAa,CAAC;KACtB;IAES,8BAAU,GAApB,UAAqB,IAAY;QAC/B,OAAO,CAAC,CAAC,IAAI,IAAI,CAAC,CAAC,IAAI,CAAC,IAAI,EAAE,CAAC;KAChC;IAES,8BAAU,GAApB,UAAqB,IAAwB;QAC3C,OAAO,OAAO,IAAI,KAAK,QAAQ,CAAC;KACjC;IAES,qCAAiB,GAA3B;QACE,OAAO,IAAI,YAAY,SAAS,GAAG,IAAI,CAAC,WAA+B,GAAG,SAAS,CAAC;KACrF;IAES,wBAAI,GAAd,UAAe,IAAmB;QAChC,IAAM,WAAW,GAAG,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,CAAC;QAC3C,IAAI,OAAO,GAAQ,IAAI,CAAC;QACxB,IAAI,UAAU,GAAQ,SAAS,CAAC;QAChC,IAAI,MAAM,GAAG,IAAI,CAAC;QAClB,IAAI,KAAK,GAAa,EAAE,CAAC;QACzB,IAAI,IAAwB,CAAC;QAE7B,IAAI,WAAW,EAAE;YACf,KAAK,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC;YAC7B,OAAO,KAAK,CAAC,MAAM,GAAG,CAAC,EAAE;gBACvB,IAAI,GAAG,KAAK,CAAC,KAAK,EAAE,CAAC;gBACrB,IAAI,IAAI,IAAI,OAAO,CAAC,IAAI,CAAC,EAAE;oBACzB,OAAO,GAAG,OAAO,CAAC,IAAI,CAAC,CAAC;iBACzB;qBAAM;oBACL,MAAM,GAAG,KAAK,CAAC;oBACf,UAAU,GAAG,IAAI,GAAG,OAAO,CAAC,IAAI,CAAC,GAAG,SAAS,CAAC;oBAC9C,MAAM;iBACP;aACF;SACF;QAED,OAAO;YACL,IAAI,EAAE,OAAO;YACb,QAAQ,EAAE,IAAI;YACd,OAAO,EAAE,UAAU;YACnB,IAAI,EAAE,KAAK;YACX,MAAM,QAAA;YACN,WAAW,aAAA;SACZ,CAAA;KACF;IAES,kCAAc,GAAxB,UAAyB,IAA+B,EAAE,QAAgB;QACxE,IAAM,GAAG,GAAG,IAAI,CAAC,iBAAiB,EAAE,CAAC;QACrC,IAAM,EAAE,GAAG,IAAI,GAAG,CAAC,IAAI,CAAC,CAAC;QACzB,EAAE,CAAC,OAAO,CAAC,IAAI,EAAE,QAAkB,CAAC,CAAC;QACrC,OAAO,EAAE,CAAC;KACX;IAEM,2BAAO,GAAd,UAAe,OAAY,EAAE,IAAY;QACvC,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC;YACxB,MAAM,IAAI,KAAK,CAAC,yBAAsB,EAAE,GAAG,IAAI,CAAE,CAAC,CAAC;QACrD,OAAO,CAAC,IAAI,CAAC,GAAG,IAAI,CAAC;KACtB;IAEM,0BAAM,GAAb,UAAc,IAAmB;QAC/B,IAAM,GAAG,GAAG,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAC5B,OAAO,GAAG,CAAC,MAAM,CAAC;KACnB;IAEM,wBAAI,GAAX,UAAY,IAAmB;QAC7B,IAAM,GAAG,GAAG,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAC5B,IAAI,GAAG,CAAC,MAAM,EAAE;YACd,OAAO,GAAG,CAAC,IAAI,CAAC;SACjB;QACD,OAAO,GAAG,CAAC,OAAO,CAAC;KACpB;IAEM,6BAAS,GAAhB,UAAiB,IAAmB;QAClC,IAAM,GAAG,GAAG,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAC5B,IAAI,CAAC,GAAG,CAAC,MAAM,EAAE;YACf,IAAM,IAAI,GAAG,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,GAAG,CAAC,IAAI,EAAE,GAAG,CAAC,IAAI,CAAC,KAAK,EAAE,EAAE,GAAG,CAAC,QAAkB,CAAC,CAAC;YAC1F,OAAO,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,IAAI,CAAc,CAAC;SACzC;QACD,OAAO,GAAG,CAAC,IAAI,CAAC;KACjB;IACH,gBAAC;AAAD,CAAC;;;;"}