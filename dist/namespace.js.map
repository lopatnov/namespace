{"version":3,"file":"namespace.js","sources":["../src/namespace.ts"],"sourcesContent":["type NamespacePath = string | Array<string>;\n\n/** Namespace class */\nexport default class Namespace {\n  public static attach<T>(to: T): T & Namespace {\n    let names = Object.keys(Namespace.prototype);\n    for (let name of names) {\n      (to as any)[name] = (Namespace.prototype as any)[name];\n    }\n    return to as T & Namespace;\n  }\n\n  constructor(path?: NamespacePath) {\n    if (!(this instanceof Namespace))\n      return new Namespace(path);\n    this.init(path);\n  }\n\n  protected init(path: NamespacePath | undefined) {\n    if (this.isValidPath(path)) {\n      const pathArr = this.parsePath(path as string | Array<string>);\n      const childName = pathArr.shift();\n      if (this.isValidKey(childName)) {\n        this.appendChildren(pathArr, childName as string);\n      }\n    }\n  }\n\n  private isValidPath(path: NamespacePath | undefined) {\n    return typeof path === 'string' || (Array.isArray(path) && path.length > 0);\n  }\n\n  private parsePath(path: NamespacePath): string[] {\n    return Array.isArray(path) ? path : path.split(this.getSplitter()).filter(x => this.filterName(x))\n  }\n\n  protected getSplitter() {\n    return /[\\[\\].\"']/gi;\n  }\n\n  protected filterName(name: string) {\n    return !!name && !!name.trim();\n  }\n\n  protected isValidKey(name: string | undefined): boolean {\n    return typeof name === 'string';\n  }\n\n  protected getNamespaceClass() {\n    return this instanceof Namespace ? this.constructor as typeof Namespace : Namespace;\n  }\n\n  protected take(path: NamespacePath) {\n    const isValidPath = this.isValidPath(path);\n    let context: any = this;\n    let errContext: any = undefined;\n    let exists = true;\n    let parts: string[] = [];\n    let part: string | undefined;\n\n    if (isValidPath) {\n      parts = this.parsePath(path);\n      while (parts.length > 0) {\n        part = parts.shift();\n        if (part && context[part]) {\n          context = context[part];\n        } else {\n          exists = false;\n          errContext = part ? context[part] : undefined;\n          break;\n        }\n      }\n    }\n\n    return {\n      last: context,\n      lastName: part,\n      errLast: errContext,\n      left: parts,\n      exists,\n      isValidPath\n    }\n  }\n\n  protected appendChildren(path: NamespacePath | undefined, propName: string) {\n    const nsc = this.getNamespaceClass();\n    const ns = new nsc(path);\n    ns.applyTo(this, propName as string);\n    return ns;\n  }\n\n  public applyTo(context: any, name: string): void {\n    if (!this.isValidKey(name))\n      throw new Error(`name of context is ${'' + name}`);\n    context[name] = this;\n  }\n\n  public exists(path: NamespacePath): boolean {\n    const res = this.take(path);\n    return res.exists;\n  }\n\n  public goto(path: NamespacePath): any {\n    const res = this.take(path);\n    if (res.exists) {\n      return res.last;\n    }\n    return res.errLast;\n  }\n\n  public namespace(path: NamespacePath): Namespace {\n    const res = this.take(path);\n    if (!res.exists) {\n      const last = this.appendChildren.call(res.last, res.left.slice(), res.lastName as string);\n      return last.goto(res.left) as Namespace;\n    }\n    return res.last;\n  }\n}"],"names":[],"mappings":"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"}